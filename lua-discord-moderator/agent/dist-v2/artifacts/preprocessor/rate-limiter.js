"use strict";var m=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var T=(e,r)=>{for(var i in r)m(e,i,{get:r[i],enumerable:!0})},M=(e,r,i,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of D(r))!E.call(e,o)&&o!==i&&m(e,o,{get:()=>r[o],enumerable:!(c=I(r,o))||c.enumerable});return e};var x=e=>M(m({},"__esModule",{value:!0}),e);var C={};T(C,{default:()=>y});module.exports=x(C);var a={};T(a,{default:()=>n});var _=require("lua-cli");var f=require("lua-cli");function g(){let e=(0,f.env)("DISCORD_REQUEST_CONTEXT");if(console.log("DISCORD_REQUEST_CONTEXT:",e),!e)return null;try{return JSON.parse(e)}catch{return console.error("Failed to parse DISCORD_REQUEST_CONTEXT:",e),null}}var h=new _.PreProcessor({name:"rate-limiter",description:"Per-user rate limiting for DMs only",priority:1,execute:async(e,r,i)=>{let u=g();if(!u||u.trigger!=="dm")return{action:"proceed"};let l=Date.now();try{let s=(e.rateLimitTimestamps||[]).filter(p=>l-p<6e4);if(s.length>=5)return{action:"block",response:`\u{1F422} Slow down! You've sent 5 messages in the last minute. Try again in ${Math.ceil((6e4-(l-s[0]))/1e3)} seconds.`};s.push(l),await e.update({rateLimitTimestamps:s})}catch(d){console.log("[RateLimiter] Error:",d)}return{action:"proceed"}}}),n=h;var t=null;for(let e of Object.keys(a)){let r=a[e];if(r&&r.name==="rate-limiter"&&typeof r.execute=="function"){t=r;break}}!t&&n&&n.name==="rate-limiter"&&(t=n);if(!t)throw new Error('PreProcessor "rate-limiter" not found in source');var R={version:"2.0.0",kind:"preprocessor",name:"rate-limiter",description:"Per-user rate limiting for DMs only",pattern:"constructor"},y={__lua_primitive__:R,primitive:{kind:"preprocessor",name:t.name,description:t.description,execute:t.execute}};
