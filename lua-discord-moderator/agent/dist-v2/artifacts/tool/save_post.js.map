{
  "version": 3,
  "sources": ["tool-save_post.ts", "../../src/tools/SavePostTool.ts", "../../src/utils/discord-context.ts"],
  "sourcesContent": ["\n// =============================================================================\n// AUTO-GENERATED ENTRY POINT (Class-based)\n// Tool: save_post\n// Source: /Users/raresastilean/Documents/Lua/Repos/lua-dev-examples/lua-discord-moderator/agent/src/tools/SavePostTool.ts\n// =============================================================================\n\nimport { SavePostTool } from '/Users/raresastilean/Documents/Lua/Repos/lua-dev-examples/lua-discord-moderator/agent/src/tools/SavePostTool.ts';\n\n// Instantiate the tool class\nconst toolInstance = new SavePostTool();\n\n// Runtime metadata\nconst __lua_primitive__ = {\n  version: '2.0.0',\n  kind: 'tool',\n  name: \"save_post\",\n  description: \"Save a resolved forum post (question + solution) to the community knowledge base for future reference\",\n  exportName: \"SavePostTool\",\n  pattern: 'class',\n};\n\n// Wrap class instance to match primitive interface\nexport default {\n  __lua_primitive__,\n  primitive: {\n    kind: 'tool',\n    name: toolInstance.name,\n    description: toolInstance.description,\n    inputSchema: toolInstance.inputSchema,\n    execute: toolInstance.execute.bind(toolInstance),\n    condition: toolInstance.condition?.bind(toolInstance),\n  },\n};\n\nexport { SavePostTool };\n", "import { LuaTool, Data } from \"lua-cli\";\nimport { z } from \"zod\";\nimport { getDiscordContext } from \"../utils/discord-context\";\n\n/**\n * Save a resolved forum post to the knowledge base.\n * Uses the Data API with vector indexing for semantic search.\n * \n * Only available when a forum thread is marked as resolved.\n */\nexport default class SavePostTool implements LuaTool {\n  name = \"save_post\";\n  description =\n    \"Save a resolved forum post (question + solution) to the community knowledge base for future reference\";\n\n  inputSchema = z.object({\n    title: z.string().describe(\"Brief title describing the issue/question\"),\n    question: z.string().describe(\"The original question or problem\"),\n    solution: z.string().describe(\"The solution or answer that resolved it\"),\n    tags: z\n      .array(z.string())\n      .optional()\n      .describe(\"Optional tags like 'webhooks', 'tools', 'deployment'\"),\n  });\n\n  /**\n   * Only enable this tool when processing a resolved forum thread.\n   * Prevents users from randomly saving posts via DMs or mentions.\n   */\n  condition = async () => {\n    const ctx = getDiscordContext();\n    return ctx?.trigger === \"forum_resolved\";\n  };\n\n  async execute(input: z.infer<typeof this.inputSchema>) {\n    // Create searchable text combining all relevant content\n    const searchText = [\n      input.title,\n      input.question,\n      input.solution,\n      ...(input.tags || []),\n    ].join(\" \");\n\n    const post = await Data.create(\n      \"resolved-posts\",\n      {\n        title: input.title,\n        question: input.question,\n        solution: input.solution,\n        tags: input.tags || [],\n        savedAt: new Date().toISOString(),\n      },\n      searchText\n    );\n\n    return {\n      success: true,\n      postId: post.id,\n      message: `Saved \"${input.title}\" to the knowledge base. This will help others with similar questions!`,\n    };\n  }\n}\n\n", "import { env } from \"lua-cli\";\n\n/**\n * Discord context passed from bot.ts via envOverride.\n */\nexport interface DiscordContext {\n  channelId: string;\n  channelName: string;\n  channelType: string;\n  guildId: string;\n  authorId: string;\n  authorTag: string;\n  messageId: string;\n  isThread: boolean;\n  parentId?: string;\n  trigger: string;\n}\n\n/**\n * Get the Discord context from the DISCORD_REQUEST_CONTEXT env variable.\n * Returns null if not available (e.g., not called from Discord).\n */\nexport function getDiscordContext(): DiscordContext | null {\n  const contextJson = env(\"DISCORD_REQUEST_CONTEXT\");\n  console.log(\"DISCORD_REQUEST_CONTEXT:\", contextJson);\n  if (!contextJson) return null;\n  \n  try {\n    return JSON.parse(contextJson) as DiscordContext;\n  } catch {\n    console.error(\"Failed to parse DISCORD_REQUEST_CONTEXT:\", contextJson);\n    return null;\n  }\n}\n\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GCAA,IAAAI,EAA8B,mBAC9BC,EAAkB,eCDlB,IAAAC,EAAoB,mBFUpB,IAAMC,EAAe,IAAIC,EAGnBC,EAAoB,CACxB,QAAS,QACT,KAAM,OACN,KAAM,YACN,YAAa,wGACb,WAAY,eACZ,QAAS,OACX,EAGOC,EAAQ,CACb,kBAAAD,EACA,UAAW,CACT,KAAM,OACN,KAAMF,EAAa,KACnB,YAAaA,EAAa,YAC1B,YAAaA,EAAa,YAC1B,QAASA,EAAa,QAAQ,KAAKA,CAAY,EAC/C,UAAWA,EAAa,WAAW,KAAKA,CAAY,CACtD,CACF",
  "names": ["tool_save_post_exports", "__export", "tool_save_post_default", "__toCommonJS", "import_lua_cli", "import_zod", "import_lua_cli", "toolInstance", "SavePostTool", "__lua_primitive__", "tool_save_post_default"]
}
